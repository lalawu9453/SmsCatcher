# Gemini 技術架構師 (代號：Mentor) - 專案交接與規劃手冊

**最後更新時間：** 2025-10-15

---

## 專案核心狀態 (Project Core Status)

- **專案目標**：打造一個高效、可擴展、多語言的臨時簡訊接收與監控工具。
- **目前架構**：
  - **後端**：Python (Flask) + Selenium + BeautifulSoup。
  - **前端**：原生 HTML/CSS/JS，透過 Flask 的 Jinja2 模板引擎渲染。
  - **國際化 (i18n)**：透過 `lang.py` 模組集中管理所有使用者介面文字。
  - **啟動方式**：支援透過命令列參數 (`--web`, `--lan`, `--ngrok_token`, `--test-ui`) 進行客製化設定。
- **核心功能**：
  - **多網站支援**：已整合 `freereceivesms.com`, `receive-smss.com`, `temp-number.com`。
  - **多語言介面**：支援繁體中文 (`zh`) 和英文 (`en`) 的終端及網頁介面。
  - **自動廣告攔截**：首次運行時自動下載並設定 uBlock Origin，提升爬蟲穩定性。
  - **來源標示**：前端清晰標示每則簡訊的來源網站，並以不同顏色區分。
  - **UI 測試模式**：支援輕量級的純前端開發測試模式。

---

## 💡 關鍵架構洞察 (Key Architectural Insights)

1.  **集中式國際化 (Centralized i18n) 架構**：
    - **設計思想**：將所有面向使用者的文字（無論是終端輸出還是網頁內容）從業務邏輯中完全分離，集中到 `lang.py` 檔案中進行管理。
    - **優點**：此架構確保了資料（文字）與視圖（顯示方式）的徹底分離。未來若要新增語言（如日文 `ja`），只需在 `lang.py` 中新增一個字典，完全無需改動任何程式邏輯。

2.  **命令列介面 (CLI) 整合**：
    - 透過 Python 內建的 `argparse` 函式庫，為應用程式提供了清晰、標準化的命令列介面。
    - 所有啟動參數都由 `argparse` 統一管理，並提供自動生成的 `--help` 文件，大幅提升了程式的易用性和可維護性。

3.  **資料驅動的前端樣式 (Data-Driven Frontend Styling)**：
    - 透過在 `index.html` 模板中動態生成 CSS class (`source-{{ item.source.lower()... }}`），我們將後端傳遞的資料與前端的視覺表現直接掛鉤，讓樣式可以根據資料變化，增強了前端的靈活性。

---

## 開發歷程與問題解決檔案 (Dev Log & Problem Solving)

1.  **功能：UI 介面優化 (Friendly & Lively Design)**
    - **挑戰**：在不引入新前端框架的前提下，將現有基礎的 UI 介面改造為更「友善活潑」的風格。
    - **解決方案**：
        1.  **字體更新**：引入 Google Fonts 的 'Nunito' 字體，提升整體視覺的親和力。
        2.  **卡片式佈局**：將簡訊列表從傳統的 `<ul><li>` 結構改為現代的 `<div>` 卡片式佈局 (`.sms-card`)，並採用 CSS Grid 實現響應式網格排列。
        3.  **視覺細節強化**：大量使用圓角 (`border-radius`)、柔和陰影 (`box-shadow`) 和更明亮的色彩變數，營造溫暖、活潑的視覺感受。
        4.  **互動效果**：為簡訊卡片新增滑鼠懸停時的輕微上浮動畫 (`transform: translateY(-4px)`)，增加互動趣味性。
        5.  **來源標示優化**：將簡訊來源的顏色標示從獨立標籤改為卡片左側的彩色邊框，使其更具現代感和整合性。

2.  **功能：新增 UI 測試模式 (UI Test Mode)**
    - **挑戰**：如何讓前端開發者在不啟動完整、耗時的後端爬蟲程序下，能快速、方便地測試 UI/UX 視覺效果？
    - **解決方案**：
        1.  **建立假資料路由**：在 `main.py` 中新增一個 `/test-ui` Flask 路由。此路由不執行任何爬蟲邏輯，而是直接渲染 `index.html` 樣板，並傳入一組預先定義好的、包含多個來源的假簡訊資料 (mock data)。
        2.  **新增啟動參數**：在 `argparse` 中加入 `--test-ui` 旗標。
        3.  **分離啟動邏輯**：在主程式 (`if __name__ == '__main__':`) 中加入條件判斷。當偵測到 `--test-ui` 參數時，程式將跳過所有爬蟲相關的初始化（如 Selenium Driver 建立、背景更新執行緒啟動），僅啟動 Flask 伺服器，從而實現一個輕量級的「純前端」開發環境。

3.  **功能：實現完整國際化 (i18n)**
    - **挑戰**：如何將散落在 `main.py`, `scraper_core.py`, `index.html` 中的所有中文文字，替換為可根據參數動態切換的結構？
    - **解決方案**：
        1.  **建立 `lang.py`**：將所有文字抽象成鍵值對，存入 `lang.py`。
        2.  **重構呼叫鏈**：修改了幾乎所有的核心函式簽名，增加了 `lang_dict` 參數，確保語言字典能從主程式一路傳遞到最深處的爬蟲函式。
        3.  **重構網頁模板**：將 `index.html` 中所有寫死的中文替換為 Jinja2 變數 `{{ lang.KEY }}`。
        4.  **修正測試**：在重構後，主動運行測試，發現了 `pytest` 依賴缺失 (`pytest-mock`) 和測試案例本身邏輯過時（斷言了舊的中文文字）等問題，並逐一修復，確保了重構的正確性。

4.  **功能：新增命令列啟動參數**
    - **挑戰**：讓使用者可以靈活選擇要爬取的網站，而不是每次都爬取全部。
    - **解決方案**：
        1.  引入 `argparse` 函式庫。
        2.  重構 `scrape_all_sites` 函式，使其接收一個 `target_urls` 列表作為參數，實現了核心邏輯與資料來源的解耦。
        3.  **重構**：將原有的 `--ngrok_token` 手動解析邏輯也統一整合到 `argparse` 中，使參數管理更為一致和優雅。

5.  **功能：優化 PR 範本**
    - **挑戰**：使 Pull Request 範本更精簡、更清晰，並引導提交者提供必要的說明。
    - **解決方案**：
        1.  在 `.github/PULL_REQUEST_TEMPLATE.md` 中新增「PR 說明」、「相關議題」和「變更類型」區塊，引導提交者提供詳細資訊。
        2.  精簡了原有的檢查清單，只保留最核心的項目，減少冗餘。
        3.  將範本內容調整為英文，以符合專案的國際化需求。

---

## 交接注意事項 (Handover Notes)

-   **啟動方式**：現在可以透過命令列參數啟動程式。使用 `uv run python main.py --help` 來查看所有可用選項。
    -   `--web {1,2,3,all}`：控制要爬取的網站。
    -   `--lan {zh,en}`：設定終端和網頁的顯示語言。
    -   `--ngrok_token YOUR_TOKEN`：在啟動時直接提供 ngrok 權杖。
-   **UI 測試**：若要單獨測試或修改前端介面，請使用 `uv run python main.py --test-ui` 啟動。這將在不執行任何爬蟲的情況下啟動伺服器。接著訪問 `http://127.0.0.1:5000/test-ui` 即可看到包含假資料的測試頁面。
-   **新增/修改文字**：若要新增或修改任何使用者介面的文字，**請勿**在 `main.py` 或 `index.html` 中寫死。請至 `lang.py` 檔案，找到對應的鍵，並同時修改 `zh` 和 `en` 字典中的值。
-   **新增爬蟲**：若要支援新網站，請遵循 `CONTRIBUTING.md` 中的「新增爬蟲撰寫框架」指南。記得將 `lang_dict` 參數傳遞給您的新函式。
-   **環境設定**：確保 `config.toml` 存在且格式正確。`uv sync` 用於同步依賴。
